<!-- Search Bar -->
<mat-form-field appearance="fill" class="search-bar">
  <mat-label>Search applicant</mat-label>
  <input matInput [(ngModel)]="searchTerm" placeholder="Name or IC" />
</mat-form-field>

<div class="main-container">
  <!-- Sidebar: Faculties and Programs -->
  <div class="sidebar">
    <mat-accordion>
      <mat-expansion-panel *ngFor="let faculty of faculties">
        <mat-expansion-panel-header>
          <mat-panel-title>{{ faculty.name }}</mat-panel-title>
        </mat-expansion-panel-header>

        <mat-nav-list>
          <mat-list-item
            *ngFor="let program of faculty.programs"
            (click)="selectProgram(program.code)"
            [class.selected]="program.code === selectedProgramCode"
          >
            {{ program.name }}
          </mat-list-item>
        </mat-nav-list>
      </mat-expansion-panel>
    </mat-accordion>
  </div>

  <!-- Main Content: Applicant Table -->
  <div class="content">
    <div *ngIf="filteredApplicants.length > 0" class="quota-button">
      <button mat-raised-button color="warn" class="sort-button">
        Quota: {{ getQuota(selectedProgramCode) }}
      </button>
    </div>
    <table
      mat-table
      [dataSource]="filteredApplicants"
      class="mat-elevation-z8"
      multiTemplateDataRows
      *ngIf="filteredApplicants.length"
    >
      <!-- ID -->
      <!-- <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef><strong>No.</strong></th>
        <td mat-cell *matCellDef="let app; let i = index">
          {{ i + 1 }}0000000000
        </td>
      </ng-container> -->

      <!-- Name -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef><strong>Name</strong></th>
        <td mat-cell *matCellDef="let app">{{ app.name }}</td>
      </ng-container>

      <!-- Program -->
      <!-- <ng-container matColumnDef="program">
        <th mat-header-cell *matHeaderCellDef>Applied Program</th>
        <td mat-cell *matCellDef="let app">{{ getProgramName(app.appliedProgram) }} ({{ app.appliedProgram}})</td>
      </ng-container> -->

      <!-- General Requirement -->
      <ng-container matColumnDef="general">
        <th mat-header-cell *matHeaderCellDef>
          <strong>General Requirement</strong>
        </th>
        <td mat-cell *matCellDef="let app">
          <span
            [ngClass]="getRequirementClass(app.generalMet, app.generalTotal)"
          >
            {{ app.generalMet }}/{{ app.generalTotal }}
          </span>
          <button
            mat-icon-button
            (click)="openRequirementDialog(app.generalDetails)"
          >
            <mat-icon>info</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Special Requirement -->
      <ng-container matColumnDef="special">
        <th mat-header-cell *matHeaderCellDef>
          <strong>Special Requirement</strong>
        </th>
        <td mat-cell *matCellDef="let app">
          <span
            [ngClass]="getRequirementClass(app.specialMet, app.specialTotal)"
          >
            {{ app.specialMet }}/{{ app.specialTotal }}
          </span>
          <button
            mat-icon-button
            (click)="openRequirementDialog(app.specialDetails)"
          >
            <mat-icon>info</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Status -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef><strong>Status</strong></th>
        <td mat-cell *matCellDef="let app">{{ app.applicationStatus }}</td>
      </ng-container>

      <!-- Table Headers and Rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
    <div *ngIf="!filteredApplicants.length" class="no-applicants">
      <i>**No applications found. Please select (another) program.</i>
    </div>

    <div *ngIf="filteredApplicants.length > 0" class="quota-button">
      <button mat-raised-button color="primary" class="sort-button">
        Sort Applicants
        <mat-icon>sort</mat-icon>
      </button>
    </div>
  </div>
</div>

<ng-template #requirementDialog let-data>
  <h2 mat-dialog-title style="text-align: center;">Requirements</h2>

  <mat-dialog-content>
    <div *ngIf="data?.length > 0; else noRequirements">
      <ng-container *ngFor="let group of groupByGraduateType(data)">
         <br>
        <h3 style="text-align: center; font-size: medium; color: black;" ><strong>{{ group.type }}</strong></h3>
        <div *ngFor="let d of group.items">
          <span [style.color]="d.met ? 'green' : 'red'">
            {{ d.subject }}: {{ d.grade }}
          </span>
          <span [style.color]="d.met ? 'green' : 'red'">
            {{ d.met ? "✅" : "❌" }}
          </span>
          <br>
        </div>
      </ng-container>
    </div>
    <ng-template #noRequirements>
      <p>No available requirements</p>
    </ng-template>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Close</button>
  </mat-dialog-actions>
</ng-template>



<!-- Send Email Button -->
<!-- <button mat-fab extended class="send-button" (click)="sendEmail()" disabled>
  Send
  <mat-icon>mail</mat-icon>
</button> -->
