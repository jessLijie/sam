{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { CommonModule } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, ViewChild } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatExpansionModule } from '@angular/material/expansion';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatSort, MatSortModule } from '@angular/material/sort';\nimport { MatTableDataSource, MatTableModule } from '@angular/material/table';\nlet ProgramManageComponent = class ProgramManageComponent {\n  constructor(http, cdr, snackBar, fb) {\n    this.http = http;\n    this.cdr = cdr;\n    this.snackBar = snackBar;\n    this.fb = fb;\n    this.isSpecialSelected = false;\n    this.isSPM = false;\n    this.isSTPM = false;\n    this.isMatriculation = false;\n    this.isDiploma = false;\n    this.displayedColumns = ['graduate_type', 'requirement', 'grade', 'action'];\n    this.generalRequirement = new MatTableDataSource([]);\n    this.selectedFaculty = null;\n    this.selectedFacultyDropdown = null;\n    this.selectedProgramCode = null;\n    this.specialRequirements = {};\n    this.editingRowIndex = null;\n    this.updatedGrade = null;\n    this.editingSpecialRowIndex = null;\n    this.updatedSpecialGrade = null;\n    this.isCreateModalOpen = false;\n    this.errorMessage = '';\n    this.programs = {};\n    this.faculties = [];\n    this.categories = [];\n    this.subjects = [];\n    this.selectedCategory = '';\n    this.selectedSubject = '';\n    this.selectedGrade = '';\n    this.grades = [];\n    this.spmGrades = [\"A+\", \"A\", \"A-\", \"B+\", \"B\", \"C\"];\n    this.otherGrades = [\"4.00\", \"3.67\", \"3.33\", \"3.00\", \"2.67\"];\n    this.muetGrades = [\"5.5\", \"5.0\", \"4.0\", \"3.0\", \"2.0\", \"1.0\"];\n    this.isSubjectModalOpen = false;\n    this.editMode = false;\n    this.selectedSubjectId = null;\n    this.getGeneralRequirement();\n    this.createForm = this.fb.group({\n      graduate_type: ['', Validators.required],\n      requirement_type: ['', Validators.required],\n      grade: ['', Validators.required],\n      subject: ['', Validators.required],\n      faculty: [''],\n      program_code: ['']\n    });\n    this.createForm.get('type')?.valueChanges.subscribe(value => {\n      this.isSpecialSelected = value === 'special';\n      this.isSPM = value === 'SPM';\n    });\n    this.subjectForm = this.fb.group({\n      category: ['', Validators.required],\n      subjectName: ['', Validators.required]\n    });\n    this.fetchCourses();\n    this.fetchFaculties();\n    this.fetchCategories();\n    this.fetchAllSubjects();\n  }\n  openSubjectModal(editMode = false) {\n    this.isSubjectModalOpen = true;\n    this.editMode = editMode;\n  }\n  closeSubjectModal() {\n    this.isSubjectModalOpen = false;\n    this.subjectForm.reset();\n  }\n  saveSubject() {\n    if (this.subjectForm.invalid) return;\n    const subjectData = this.subjectForm.value;\n    if (this.editMode && this.selectedSubjectId) {\n      this.http.put(`https://localhost:7108/api/subjects/${this.selectedSubjectId}`, subjectData).subscribe(() => {\n        this.snackBar.open('Subject updated successfully!', 'Close', {\n          duration: 2000\n        });\n        this.fetchAllSubjects();\n        this.closeSubjectModal();\n      }, error => console.error('Error updating subject:', error));\n    } else {\n      this.http.post('https://localhost:7108/api/subjects', subjectData).subscribe(() => {\n        this.snackBar.open('Subject added successfully!', 'Close', {\n          duration: 2000\n        });\n        this.fetchAllSubjects();\n        this.closeSubjectModal();\n      }, error => console.error('Error adding subject:', error));\n    }\n  }\n  deleteSubject(subjectId) {\n    const confirmDelete = window.confirm('Are you sure you want to delete this subject?');\n    if (confirmDelete) {\n      this.http.delete(`https://localhost:7108/api/subjects/${subjectId}`).subscribe(() => {\n        this.snackBar.open('Subject deleted successfully!', 'Close', {\n          duration: 2000\n        });\n        this.fetchAllSubjects();\n      }, error => console.error('Error deleting subject:', error));\n    }\n  }\n  fetchCategories() {\n    this.http.get('https://localhost:7108/api/Course/categories').subscribe(response => {\n      this.categories = response;\n    }, error => {\n      console.error('Error fetching categories:', error);\n    });\n  }\n  fetchAllSubjects() {\n    this.http.get('https://localhost:7108/api/subjects').subscribe(response => {\n      this.subjects = response;\n    }, error => {\n      console.error('Error fetching subjects:', error);\n    });\n  }\n  fetchSubjects(category) {\n    this.http.get(`https://localhost:7108/api/Course/subjects/${category}`).subscribe(response => {\n      this.subjects = response;\n    }, error => {\n      console.error('Error fetching subjects:', error);\n    });\n  }\n  onCategoryChange() {\n    if (this.selectedCategory) {\n      this.fetchSubjects(this.selectedCategory);\n      this.selectedSubject = '';\n      this.setGradeOptions();\n    }\n  }\n  onSubjectChange() {\n    this.setGradeOptions();\n  }\n  setGradeOptions() {\n    if (this.selectedCategory === 'SPM') {\n      this.grades = this.spmGrades;\n    } else if (this.selectedSubject === 'MUET') {\n      this.grades = this.muetGrades;\n    } else {\n      this.grades = this.otherGrades;\n    }\n  }\n  fetchCourses() {\n    this.http.get('https://localhost:7108/api/Course/courses').subscribe(response => {\n      this.programs = response;\n    }, error => {\n      console.error('Error fetching courses:', error);\n    });\n  }\n  fetchFaculties() {\n    this.http.get('https://localhost:7108/api/Course/faculties').subscribe(response => {\n      this.faculties = response;\n    }, error => {\n      console.error('Error fetching faculties:', error);\n    });\n  }\n  getGeneralRequirement() {\n    this.http.get('https://localhost:7108/api/EntryRequirement/general').subscribe(res => {\n      this.generalRequirement = new MatTableDataSource(res);\n      if (this.sort) {\n        this.generalRequirement.sort = this.sort;\n      }\n      this.cdr.detectChanges();\n    });\n  }\n  ngAfterViewInit() {\n    if (this.sort) {\n      this.generalRequirement.sort = this.sort;\n    }\n  }\n  getSpecialRequirements(programCode) {\n    this.http.get(`https://localhost:7108/api/EntryRequirement/special/${programCode}`).subscribe(data => {\n      this.specialRequirements[programCode] = data;\n      this.cdr.detectChanges();\n    });\n  }\n  startEditing(rowIndex, currentGrade) {\n    this.editingRowIndex = rowIndex;\n    this.updatedGrade = currentGrade;\n  }\n  saveChanges(rowIndex) {\n    const row = this.generalRequirement.data[rowIndex];\n    const updatedRequirement = {\n      id: row.id,\n      grade: this.updatedGrade,\n      subject: row.subject,\n      requirement_type: row.requirement_type,\n      graduate_type: row.graduate_type\n    };\n    this.http.put(`https://localhost:7108/api/EntryRequirement/update/${row.id}`, updatedRequirement).subscribe(res => {\n      console.log('Update successful:', res);\n      this.snackBar.open('Grade edited successfully!', 'Close', {\n        duration: 2000,\n        horizontalPosition: 'right',\n        verticalPosition: 'top'\n      });\n      this.generalRequirement.data[rowIndex].grade = this.updatedGrade;\n      this.editingRowIndex = null;\n      this.updatedGrade = null;\n      console.log(this.editingRowIndex, this.updatedGrade);\n      this.cdr.markForCheck();\n    }, err => {\n      console.error('Update failed:', err);\n    });\n  }\n  startEditingSpecial(programCode, rowIndex, currentGrade) {\n    this.editingSpecialRowIndex = rowIndex;\n    this.updatedSpecialGrade = currentGrade;\n  }\n  saveSpecialChanges(programCode, rowIndex) {\n    const specialRequirement = this.specialRequirements[programCode][rowIndex];\n    const updatedRequirement = {\n      ...specialRequirement,\n      grade: this.updatedSpecialGrade\n    };\n    this.http.put(`https://localhost:7108/api/EntryRequirement/update/${specialRequirement.id}`, updatedRequirement).subscribe(res => {\n      console.log('Special Requirement Update Successful:', res);\n      this.snackBar.open('Grade edited successfully!', 'Close', {\n        duration: 2000,\n        horizontalPosition: 'right',\n        verticalPosition: 'top'\n      });\n      if (this.updatedSpecialGrade !== null) {\n        this.specialRequirements[programCode][rowIndex].grade = this.updatedSpecialGrade;\n      }\n      this.editingSpecialRowIndex = null;\n      this.updatedSpecialGrade = null;\n      this.cdr.markForCheck();\n    }, err => {\n      console.error('Update failed:', err);\n    });\n  }\n  confirmDelete(id, programCode) {\n    const confirmResult = window.confirm(\"Are you sure you want to delete this entry?\");\n    if (confirmResult) {\n      this.deleteEntryRequirement(id, programCode);\n    }\n  }\n  deleteEntryRequirement(id, programCode) {\n    this.http.delete(`https://localhost:7108/api/EntryRequirement/delete/${id}`, {\n      responseType: 'text'\n    }).subscribe(response => {\n      console.log('Delete successful:', response);\n      this.generalRequirement.data = this.generalRequirement.data.filter(item => item.id !== id);\n      if (programCode) {\n        this.specialRequirements[programCode] = this.specialRequirements[programCode].filter(item => item.id !== id);\n      }\n      this.snackBar.open('Entry requirement deleted successfully!', 'Close', {\n        duration: 2000,\n        horizontalPosition: 'right',\n        verticalPosition: 'top'\n      });\n      this.cdr.detectChanges();\n    }, error => {\n      console.error('Delete failed:', error);\n      this.snackBar.open('Failed to delete entry requirement.', 'Close', {\n        duration: 2000,\n        horizontalPosition: 'right',\n        verticalPosition: 'top'\n      });\n    });\n  }\n  openCreateModal() {\n    this.isCreateModalOpen = true;\n  }\n  closeCreateModal() {\n    this.isCreateModalOpen = false;\n    this.createForm.reset();\n  }\n  submitEntry() {\n    if (this.createForm.invalid) {\n      return;\n    }\n    const formData = this.createForm.value;\n    this.http.post('https://localhost:7108/api/EntryRequirement/create', formData).subscribe(response => {\n      console.log('Form submitted successfully!', response);\n      this.snackBar.open('Form submitted successfully!', 'Close', {\n        duration: 3000,\n        horizontalPosition: 'right',\n        verticalPosition: 'top'\n      });\n      this.closeCreateModal();\n      this.getGeneralRequirement();\n      this.getSpecialRequirements(formData.program_code);\n    }, error => {\n      console.error('Error submitting the form:', error);\n      // Check if the error is a constraint violation (duplicate graduate_type + requirement_type)\n      if (error.status === 409) {\n        this.errorMessage = error.error; // Set the error message from the backend\n      } else {\n        this.errorMessage = 'An error occurred while submitting the form.';\n      }\n    });\n  }\n  // Method to change behavior when type is selected as 'special'\n  onTypeChange(event) {\n    if (event.value === 'special') {\n      this.isSpecialSelected = true;\n    } else {\n      this.isSpecialSelected = false;\n    }\n  }\n  onTypeChangeSubject(event) {\n    this.isSPM = event.value === 'SPM';\n    this.isSTPM = event.value === 'STPM';\n    this.isDiploma = event.value === 'Diploma';\n    this.isMatriculation = event.value === 'Matriculation';\n  }\n  clearFilter() {\n    this.selectedFaculty = null;\n    this.selectedProgramCode = null;\n  }\n  getProgramsForFaculty() {\n    return this.selectedFaculty ? this.programs[this.selectedFaculty] : [];\n  }\n  getProgramsForFacultyDropdown() {\n    const faculty = this.createForm.value.faculty;\n    return this.programs[faculty] || [];\n  }\n  selectProgram(programCode) {\n    this.selectedProgramCode = programCode;\n    this.getSpecialRequirements(programCode);\n  }\n  getCategoryClass(category) {\n    switch (category) {\n      case 'SPM':\n        return 'spm-tag';\n      case 'STPM':\n        return 'stpm-tag';\n      // case 'MUET':\n      //   return 'muet-tag';\n      case 'Diploma':\n        return 'diploma-tag';\n      case 'Matriculation':\n        return 'matriculation-tag';\n      default:\n        return '';\n    }\n  }\n};\n__decorate([ViewChild(MatSort, {\n  static: false\n})], ProgramManageComponent.prototype, \"sort\", void 0);\nProgramManageComponent = __decorate([Component({\n  selector: 'app-program-manage',\n  standalone: true,\n  imports: [CommonModule, MatTableModule, MatSortModule, MatFormFieldModule, MatSelectModule, MatInputModule, FormsModule, MatIconModule, MatExpansionModule, MatButtonModule, MatSnackBarModule, ReactiveFormsModule, MatChipsModule, MatBadgeModule],\n  templateUrl: './program-manage.component.html',\n  styleUrls: ['./program-manage.component.css'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})], ProgramManageComponent);\nexport { ProgramManageComponent };","map":{"version":3,"mappings":"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","names":["CommonModule","ChangeDetectionStrategy","Component","ViewChild","FormsModule","ReactiveFormsModule","Validators","MatBadgeModule","MatButtonModule","MatChipsModule","MatExpansionModule","MatFormFieldModule","MatIconModule","MatInputModule","MatSelectModule","MatSnackBarModule","MatSort","MatSortModule","MatTableDataSource","MatTableModule","ProgramManageComponent","constructor","http","cdr","snackBar","fb","getGeneralRequirement","createForm","group","graduate_type","required","requirement_type","grade","subject","faculty","program_code","get","valueChanges","subscribe","value","isSpecialSelected","isSPM","subjectForm","category","subjectName","fetchCourses","fetchFaculties","fetchCategories","fetchAllSubjects","openSubjectModal","editMode","isSubjectModalOpen","closeSubjectModal","reset","saveSubject","invalid","subjectData","selectedSubjectId","put","open","duration","error","console","post","deleteSubject","subjectId","confirmDelete","window","confirm","delete","response","categories","subjects","fetchSubjects","onCategoryChange","selectedCategory","selectedSubject","setGradeOptions","onSubjectChange","grades","spmGrades","muetGrades","otherGrades","programs","faculties","res","generalRequirement","sort","detectChanges","ngAfterViewInit","getSpecialRequirements","programCode","data","specialRequirements","startEditing","rowIndex","currentGrade","editingRowIndex","updatedGrade","saveChanges","row","updatedRequirement","id","log","horizontalPosition","verticalPosition","markForCheck","err","startEditingSpecial","editingSpecialRowIndex","updatedSpecialGrade","saveSpecialChanges","specialRequirement","confirmResult","deleteEntryRequirement","responseType","filter","item","openCreateModal","isCreateModalOpen","closeCreateModal","submitEntry","formData","status","errorMessage","onTypeChange","event","onTypeChangeSubject","isSTPM","isDiploma","isMatriculation","clearFilter","selectedFaculty","selectedProgramCode","getProgramsForFaculty","getProgramsForFacultyDropdown","selectProgram","getCategoryClass","__decorate","static","selector","standalone","imports","templateUrl","styleUrls","changeDetection","OnPush"],"sourceRoot":"","sources":["C:\\Users\\jessm\\OneDrive\\Desktop\\work\\FYP\\sam\\ClientApp\\src\\app\\program-manage\\program-manage.component.ts"],"sourcesContent":["import { CommonModule } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport { AfterViewInit, ChangeDetectionStrategy, ChangeDetectorRef, Component, ViewChild } from '@angular/core';\nimport { FormBuilder, FormGroup, FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatExpansionModule } from '@angular/material/expansion';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSnackBar, MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatSort, MatSortModule } from '@angular/material/sort';\nimport { MatTableDataSource, MatTableModule } from '@angular/material/table';\n\nexport interface Faculty {\n  facultyCode: string;\n  faculty: string;\n}\n\nexport interface Program {\n  code: string;\n  name: string;\n}\n\ninterface Subject {\n  id?: number;\n  category: string;\n  subjectName: string;\n}\n\nexport interface SpecialEntryRequirement {\n  id: number;\n  category: string;\n  requirement: string;\n  grade: string;\n}\n\n\n@Component({\n  selector: 'app-program-manage',\n  standalone: true,\n  imports: [\n    CommonModule,\n    MatTableModule,\n    MatSortModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    MatInputModule,\n    FormsModule,\n    MatIconModule,\n    MatExpansionModule,\n    MatButtonModule,\n    MatSnackBarModule,\n    ReactiveFormsModule,\n    MatChipsModule,\n    MatBadgeModule\n  ],\n  templateUrl: './program-manage.component.html',\n  styleUrls: ['./program-manage.component.css'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class ProgramManageComponent implements AfterViewInit {\n  constructor(private http: HttpClient,\n    private cdr: ChangeDetectorRef,\n    private snackBar: MatSnackBar,\n    private fb: FormBuilder\n\n  ) {\n    this.getGeneralRequirement();\n    this.createForm = this.fb.group({\n      graduate_type: ['', Validators.required],\n      requirement_type: ['', Validators.required],\n      grade: ['', Validators.required],\n      subject: ['', Validators.required],\n      faculty: [''],\n      program_code: [''],\n    });\n    this.createForm.get('type')?.valueChanges.subscribe(value => {\n      this.isSpecialSelected = value === 'special';\n      this.isSPM = value === 'SPM';\n    });\n    this.subjectForm = this.fb.group({\n      category: ['', Validators.required],\n      subjectName: ['', Validators.required]\n    });\n    this.fetchCourses();\n    this.fetchFaculties();\n    this.fetchCategories();\n    this.fetchAllSubjects();\n  }\n  createForm: FormGroup;\n  isSpecialSelected: boolean = false;\n  isSPM: boolean = false;\n  isSTPM: boolean = false;\n  isMatriculation: boolean = false;\n  isDiploma: boolean = false;\n  displayedColumns: string[] = ['graduate_type', 'requirement', 'grade', 'action'];\n  generalRequirement: MatTableDataSource<any> = new MatTableDataSource<any>([]);\n  selectedFaculty: string | null = null;\n  selectedFacultyDropdown: string | null = null;\n  selectedProgramCode: string | null = null;\n  specialRequirements: { [programCode: string]: SpecialEntryRequirement[] } = {};\n  editingRowIndex: number | null = null;\n  updatedGrade: string | null = null;\n  editingSpecialRowIndex: number | null = null;\n  updatedSpecialGrade: string | null = null;\n  isCreateModalOpen: boolean = false;\n  errorMessage: string = '';\n  programs: { [key: string]: Program[] } = {};\n  faculties: Faculty[] = [];\n  categories: string[] = [];\n  subjects: Subject[] = [];\n  selectedCategory: string = '';\n  selectedSubject: string = '';\n  selectedGrade: string = '';\n  grades: string[] = [];\n  spmGrades = [\"A+\", \"A\", \"A-\", \"B+\", \"B\", \"C\"];\n  otherGrades = [\"4.00\", \"3.67\", \"3.33\", \"3.00\", \"2.67\"];\n  muetGrades = [\"5.5\", \"5.0\", \"4.0\", \"3.0\", \"2.0\", \"1.0\"];\n\n  isSubjectModalOpen: boolean = false;\n  editMode: boolean = false;\n  subjectForm: FormGroup;\n  selectedSubjectId: number | null = null;\n\n  openSubjectModal(editMode: boolean = false) {\n    this.isSubjectModalOpen = true;\n    this.editMode = editMode;\n  }\n\n  closeSubjectModal() {\n    this.isSubjectModalOpen = false;\n    this.subjectForm.reset();\n  }\n\n  saveSubject(): void {\n    if (this.subjectForm.invalid) return;\n\n    const subjectData: Subject = this.subjectForm.value;\n\n    if (this.editMode && this.selectedSubjectId) {\n      this.http.put(`https://localhost:7108/api/subjects/${this.selectedSubjectId}`, subjectData)\n        .subscribe(() => {\n          this.snackBar.open('Subject updated successfully!', 'Close', { duration: 2000 });\n          this.fetchAllSubjects();\n          this.closeSubjectModal();\n        }, error => console.error('Error updating subject:', error));\n    } else {\n      this.http.post('https://localhost:7108/api/subjects', subjectData)\n        .subscribe(() => {\n          this.snackBar.open('Subject added successfully!', 'Close', { duration: 2000 });\n          this.fetchAllSubjects();\n          this.closeSubjectModal();\n        }, error => console.error('Error adding subject:', error));\n    }\n  }\n\n  deleteSubject(subjectId: number): void {\n    const confirmDelete = window.confirm('Are you sure you want to delete this subject?');\n\n    if (confirmDelete) {\n      this.http.delete(`https://localhost:7108/api/subjects/${subjectId}`)\n        .subscribe(() => {\n          this.snackBar.open('Subject deleted successfully!', 'Close', { duration: 2000 });\n          this.fetchAllSubjects();\n        }, error => console.error('Error deleting subject:', error));\n    }\n  }\n\n  fetchCategories(): void {\n    this.http.get<string[]>('https://localhost:7108/api/Course/categories')\n      .subscribe(response => {\n        this.categories = response;\n      }, error => {\n        console.error('Error fetching categories:', error);\n      });\n  }\n\n  fetchAllSubjects(): void {\n    this.http.get<Subject[]>('https://localhost:7108/api/subjects')\n      .subscribe(response => {\n        this.subjects = response;\n      }, error => {\n        console.error('Error fetching subjects:', error);\n      });\n  }\n\n  fetchSubjects(category: string): void {\n    this.http.get<Subject[]>(`https://localhost:7108/api/Course/subjects/${category}`)\n      .subscribe(response => {\n        this.subjects = response;\n      }, error => {\n        console.error('Error fetching subjects:', error);\n      });\n  }\n\n  onCategoryChange(): void {\n    if (this.selectedCategory) {\n      this.fetchSubjects(this.selectedCategory);\n      this.selectedSubject = '';\n      this.setGradeOptions();\n    }\n  }\n\n  onSubjectChange(): void {\n    this.setGradeOptions();\n  }\n\n  setGradeOptions(): void {\n    if (this.selectedCategory === 'SPM') {\n      this.grades = this.spmGrades;\n    } else if (this.selectedSubject === 'MUET') {\n      this.grades = this.muetGrades;\n    } else {\n      this.grades = this.otherGrades;\n    }\n  }\n\n  fetchCourses(): void {\n    this.http.get<{ [key: string]: Program[] }>('https://localhost:7108/api/Course/courses')\n      .subscribe(response => {\n        this.programs = response;\n      }, error => {\n        console.error('Error fetching courses:', error);\n      });\n  }\n\n  fetchFaculties(): void {\n    this.http.get<Faculty[]>('https://localhost:7108/api/Course/faculties')\n      .subscribe(response => {\n        this.faculties = response;\n      }, error => {\n        console.error('Error fetching faculties:', error);\n      });\n  }\n\n  getGeneralRequirement() {\n    this.http.get('https://localhost:7108/api/EntryRequirement/general')\n      .subscribe((res: any) => {\n        this.generalRequirement = new MatTableDataSource(res);\n        if (this.sort) {\n          this.generalRequirement.sort = this.sort;\n        }\n        this.cdr.detectChanges();\n      });\n  }\n\n  @ViewChild(MatSort, { static: false }) sort: MatSort | undefined;\n  ngAfterViewInit() {\n    if (this.sort) {\n      this.generalRequirement.sort = this.sort;\n    }\n  }\n\n\n  getSpecialRequirements(programCode: string) {\n    this.http.get<SpecialEntryRequirement[]>(`https://localhost:7108/api/EntryRequirement/special/${programCode}`)\n      .subscribe((data) => {\n        this.specialRequirements[programCode] = data;\n        this.cdr.detectChanges();\n      });\n  }\n\n  startEditing(rowIndex: number, currentGrade: string) {\n    this.editingRowIndex = rowIndex;\n    this.updatedGrade = currentGrade;\n  }\n\n  saveChanges(rowIndex: number) {\n    const row = this.generalRequirement.data[rowIndex];\n    const updatedRequirement = {\n      id: row.id,\n      grade: this.updatedGrade,\n      subject: row.subject,\n      requirement_type: row.requirement_type,\n      graduate_type: row.graduate_type,\n    };\n\n    this.http.put(`https://localhost:7108/api/EntryRequirement/update/${row.id}`, updatedRequirement).subscribe(\n      (res) => {\n        console.log('Update successful:', res);\n        this.snackBar.open('Grade edited successfully!', 'Close', {\n          duration: 2000,\n          horizontalPosition: 'right',\n          verticalPosition: 'top',\n        });\n        this.generalRequirement.data[rowIndex].grade = this.updatedGrade;\n        this.editingRowIndex = null;\n        this.updatedGrade = null;\n        console.log(this.editingRowIndex, this.updatedGrade);\n        this.cdr.markForCheck();\n      },\n      (err) => {\n        console.error('Update failed:', err);\n      }\n    );\n  }\n\n  startEditingSpecial(programCode: string, rowIndex: number, currentGrade: string) {\n    this.editingSpecialRowIndex = rowIndex;\n    this.updatedSpecialGrade = currentGrade;\n  }\n\n  saveSpecialChanges(programCode: string, rowIndex: number) {\n    const specialRequirement = this.specialRequirements[programCode][rowIndex];\n    const updatedRequirement = {\n      ...specialRequirement,\n      grade: this.updatedSpecialGrade,\n    };\n\n    this.http.put(`https://localhost:7108/api/EntryRequirement/update/${specialRequirement.id}`, updatedRequirement).subscribe(\n      (res) => {\n        console.log('Special Requirement Update Successful:', res);\n        this.snackBar.open('Grade edited successfully!', 'Close', {\n          duration: 2000,\n          horizontalPosition: 'right',\n          verticalPosition: 'top',\n        });\n        if (this.updatedSpecialGrade !== null) {\n          this.specialRequirements[programCode][rowIndex].grade = this.updatedSpecialGrade;\n        }\n        this.editingSpecialRowIndex = null;\n        this.updatedSpecialGrade = null;\n        this.cdr.markForCheck();\n      },\n      (err) => {\n        console.error('Update failed:', err);\n      }\n    );\n  }\n\n  confirmDelete(id: number, programCode?: string) {\n    const confirmResult = window.confirm(\"Are you sure you want to delete this entry?\");\n    if (confirmResult) {\n      this.deleteEntryRequirement(id, programCode);\n    }\n  }\n\n  deleteEntryRequirement(id: number, programCode?: string) {\n    this.http.delete(`https://localhost:7108/api/EntryRequirement/delete/${id}`, { responseType: 'text' })\n      .subscribe(\n        (response) => {\n          console.log('Delete successful:', response);\n          this.generalRequirement.data = this.generalRequirement.data.filter(item => item.id !== id);\n          if (programCode) {\n            this.specialRequirements[programCode] = this.specialRequirements[programCode].filter(item => item.id !== id);\n          }\n\n          this.snackBar.open('Entry requirement deleted successfully!', 'Close', {\n            duration: 2000,\n            horizontalPosition: 'right',\n            verticalPosition: 'top',\n          });\n\n          this.cdr.detectChanges();\n        },\n        (error) => {\n          console.error('Delete failed:', error);\n          this.snackBar.open('Failed to delete entry requirement.', 'Close', {\n            duration: 2000,\n            horizontalPosition: 'right',\n            verticalPosition: 'top',\n          });\n        }\n      );\n  }\n\n  openCreateModal() {\n    this.isCreateModalOpen = true;\n  }\n\n  closeCreateModal() {\n    this.isCreateModalOpen = false;\n    this.createForm.reset();\n  }\n\n  submitEntry(): void {\n    if (this.createForm.invalid) {\n      return;\n    }\n\n    const formData = this.createForm.value;\n\n    this.http.post('https://localhost:7108/api/EntryRequirement/create', formData)\n      .subscribe(\n        (response) => {\n          console.log('Form submitted successfully!', response);\n          this.snackBar.open('Form submitted successfully!', 'Close', {\n            duration: 3000,\n            horizontalPosition: 'right',\n            verticalPosition: 'top',\n          });\n\n          this.closeCreateModal();\n          this.getGeneralRequirement();\n          this.getSpecialRequirements(formData.program_code);\n        },\n        (error) => {\n          console.error('Error submitting the form:', error);\n\n          // Check if the error is a constraint violation (duplicate graduate_type + requirement_type)\n          if (error.status === 409) {\n            this.errorMessage = error.error;  // Set the error message from the backend\n          } else {\n            this.errorMessage = 'An error occurred while submitting the form.';\n          }\n        }\n      );\n  }\n\n  // Method to change behavior when type is selected as 'special'\n  onTypeChange(event: any) {\n    if (event.value === 'special') {\n      this.isSpecialSelected = true;\n    } else {\n      this.isSpecialSelected = false;\n    }\n  }\n\n  onTypeChangeSubject(event: any) {\n    this.isSPM = event.value === 'SPM';\n    this.isSTPM = event.value === 'STPM';\n    this.isDiploma = event.value === 'Diploma';\n    this.isMatriculation = event.value === 'Matriculation';\n  }\n\n  clearFilter(): void {\n    this.selectedFaculty = null;\n    this.selectedProgramCode = null;\n  }\n\n  getProgramsForFaculty(): Program[] {\n    return this.selectedFaculty ? this.programs[this.selectedFaculty] : [];\n  }\n\n  getProgramsForFacultyDropdown() {\n    const faculty = this.createForm.value.faculty;\n    return this.programs[faculty] || [];\n  }\n\n  selectProgram(programCode: string): void {\n    this.selectedProgramCode = programCode;\n    this.getSpecialRequirements(programCode);\n  }\n\n  getCategoryClass(category: string): string {\n    switch (category) {\n      case 'SPM':\n        return 'spm-tag';\n      case 'STPM':\n        return 'stpm-tag';\n      // case 'MUET':\n      //   return 'muet-tag';\n      case 'Diploma':\n        return 'diploma-tag';\n      case 'Matriculation':\n        return 'matriculation-tag';\n      default:\n        return '';\n    }\n  }\n\n  // faculties: Faculty[] = [\n  //   { value: 'fc', viewValue: 'Faculty of Computing' },\n  //   { value: 'fkm', viewValue: 'Faculty of Mechanical Engineering' },\n  //   { value: 'fke', viewValue: 'Faculty of Engineering' },\n  // ];\n\n  // programs: { [key: string]: Program[] } = {\n  //   fc: [\n  //     { code: 'UT6481001', name: 'Software Engineering' },\n  //     { code: 'UT6481002', name: 'Data Engineering' },\n  //     { code: 'UT6481003', name: 'Bioinformatics' },\n  //     { code: 'UT6481004', name: 'Network and Cybersecurity' },\n  //     { code: 'UT6481005', name: 'Graphics and Multimedia' },\n  //   ],\n  //   fkm: [\n  //     { code: 'UT6521001', name: 'Pure Mechanics' },\n  //     { code: 'UT6521003', name: 'Manufacturing' },\n  //     { code: 'UT6521004', name: 'Industrial' },\n  //     { code: 'UT6525001', name: 'Aerospace' },\n  //     { code: 'UT6525002', name: 'Automotive' },\n  //     { code: 'UT6525003', name: 'Offshore' },\n  //   ],\n  //   fke: [\n  //     { code: 'UT6522002', name: 'Electrical Engineering' },\n  //     { code: 'UT6523001', name: 'Electronic Engineering' },\n  //     { code: 'UT6523002', name: 'Mechatronics Engineering' },\n  //     { code: 'UT6523003', name: 'Biomedical Engineering' },\n  //   ],\n  // };\n\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}